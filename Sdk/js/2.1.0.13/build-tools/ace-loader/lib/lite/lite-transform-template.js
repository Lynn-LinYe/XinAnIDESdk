"use strict";var _optionRules;function _createForOfIteratorHelper(r){if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(r=_unsupportedIterableToArray(r))){var t=0,e=function(){};return{s:e,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(r){throw r},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,c=!1;return{s:function(){n=r[Symbol.iterator]()},n:function(){var r=n.next();return o=r.done,r},e:function(r){c=!0,a=r},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(r,t){if(r){if("string"==typeof r)return _arrayLikeToArray(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(r,t):void 0}}function _arrayLikeToArray(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function _defineProperty(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}var _require=require("./lite-utils"),isFunction=_require.isFunction,isObject=_require.isObject,isUndefined=_require.isUndefined,_require2=require("./lite-enum"),SPECIAL_STYLE=_require2.SPECIAL_STYLE,REGEXP_NUMBER_PX=_require2.REGEXP_NUMBER_PX,REGEXP_COLOR=_require2.REGEXP_COLOR,REGEXP_UNIT=_require2.REGEXP_UNIT,REGXP_QUOTES=_require2.REGXP_QUOTES,parameterArray=[],parameter1="",parameter2="",ATTRBUTES="attrs",EVENTS_ON_FUNC="on",KEY="key",AST_KEY={ATTR:"attr",CLASSLIST:"classList",STYLE:"style",EVENTS:"events",TYPE:"type",CHILDREN:"children",KEY:"key"},EVENT_KEY=["onBubbleEvents","catchBubbleEvents","onCaptureEvents","catchCaptureEvents"],optionRules=(_defineProperty(_optionRules={},AST_KEY.ATTR,function(r,t,e){return 0!==Object.keys(t.attr).length&&(r+="'".concat(ATTRBUTES,"' : ").concat(transformProps(t.attr),",")),r}),_defineProperty(_optionRules,AST_KEY.CLASSLIST,function(r,t,e){return r+=sortClass(t[e])}),_defineProperty(_optionRules,AST_KEY.STYLE,function(r,t,e){return r+=sortStyle(t[e])}),_defineProperty(_optionRules,AST_KEY.EVENTS,function(r,t,e){return r+="'".concat(EVENTS_ON_FUNC,"' : ").concat(transformEvents(t.events),",")}),_defineProperty(_optionRules,AST_KEY.KEY,function(r,t,e){return r+="'".concat(KEY,"' : ").concat(t.key,",")}),_optionRules),styleRules=[{match:function(r,t){return r===SPECIAL_STYLE.ANIMATION_DELAY||r===SPECIAL_STYLE.ANIMATION_DURATION},action:function(r,t,e){return r+="'".concat(t,"' : ").concat(JSON.stringify(e),",")}},{match:function(r,t){return r===SPECIAL_STYLE.ANIMATION_ITERATION_COUNT},action:function(r,t,e){return-1===e&&(e="infinite"),r+="'".concat(t,"' : ").concat(JSON.stringify(e),",")}},{match:function(r,t){return r===SPECIAL_STYLE.BACKGROUND_IMAGE},action:function(r,t,e){return r+="'".concat(t,"' : ").concat(checkType(e.replace(REGXP_QUOTES,"")),",")}},{match:function(r,t){return!0},action:function(r,t,e){return r+="'".concat(t,"' : ").concat(checkType(e),",")}}];function transformTemplate(r){var t=Function("return ".concat(r))(),e=isObject(t)?transformNode(t):"_c('div')";return e=e.replace(/,$/,""),"function (vm) { var _vm = vm || this; return ".concat(e," }")}function transformNode(r){return r.repeat&&!r.forCompiled?transformFor(r):r.shown&&!r.ifCompiled?transformIf(r):transformNodeDetail(r)}function transformNodeDetail(r){var t=r.type,e=transformOptions(r),n=transformChildren(r);return"_c('".concat(t,"'").concat(e?", ".concat(e," "):"").concat(n?", ".concat(n," "):"","),")}function transformOptions(r){var t="";parameter2=parameterArray[parameterArray.length-1],r.attr&&r.attr.tid&&""!==parameter2&&(r.key="".concat(parameter2,".").concat(r.attr.tid),delete r.attr.tid);for(var e=0,n=Object.keys(r);e<n.length;e++){var a=n[e];a!==AST_KEY.TYPE&&a!==AST_KEY.CHILDREN&&optionRules[a]&&(t=optionRules[a](t,r,a))}return""===t?null:t="{"+t.replace(/,$/,"")+"}"}function sortClass(r){var t="",e=checkType(r);return isFunction(r)||isUndefined(r)?t+="'".concat("dynamicClass","' : ").concat(formatForFunc(e),","):t+="'".concat("staticClass","' : ").concat(e,","),t}function sortStyle(r){for(var t="",e="",n=0,a=Object.keys(r);n<a.length;n++){var o=a[n],c=r[o];if(isFunction(c))e+="'".concat(o,"' : ").concat(formatForFunc(c),",");else for(var i=0;i<styleRules.length;i++)if(styleRules[i].match(o,c)){t=styleRules[i].action(t,o,c);break}}return""!==t&&(t="'".concat("staticStyle","' : {").concat(t.replace(/,$/,""),"}, ")),""!==e&&(e="'".concat("dynamicStyle","' :{").concat(e.replace(/,$/,""),"},")),t+e}function checkType(r){return isFunction(r)||isUndefined(r)?formatForFunc(r):isObject(r)?transformProps(r):isNaN(Number(r))?REGEXP_NUMBER_PX.test(r)?parseInt(r.replace(REGEXP_UNIT,""),10):REGEXP_COLOR.test(r)?parseInt(r.slice(1),16):"true"===r||"false"!==r&&JSON.stringify(r):Number(r)}function transformProps(r){for(var t="",e=0,n=Object.keys(r);e<n.length;e++){var a=n[e],o=r[a];"value"===a?isFunction(o)||isUndefined(o)?t+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):t+="'".concat(a,"' : ").concat(JSON.stringify(r[a]),","):t+="'".concat(a,"' : ").concat(checkType(r[a]),",")}return t="{".concat(t.replace(/,$/,""),"}")}function transformEvents(r){for(var t="",e=0,n=Object.keys(r);e<n.length;e++){var a=n[e];isFunction(r[a])?t+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):t+="'".concat(a,"' : ").concat(formatForString(r[a]),",")}return t="{".concat(t.replace(/,$/,""),"}")}function formatForString(r){var t,e=!1,n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(t=n.n()).done;){var a=t.value,o="$"===a.charAt(0)?"\\":"";if(new RegExp(o+a).test(r)){e=!0;break}}}catch(r){n.e(r)}finally{n.f()}return e?r:"_vm."+r}function transformFor(r){var t=r.repeat.exp?r.repeat.exp:r.repeat;parameterArray.push(r.repeat.key?r.repeat.key:"$idx"),parameterArray.push(r.repeat.value?r.repeat.value:"$item"),r.forCompiled=!0,t=formatForFunc(t);var e=transformNode(r).replace(/,$/,"");parameter2=parameterArray[parameterArray.length-1];var n=""!==(parameter1=parameterArray[parameterArray.length-2])&&""!==parameter2?",":"";return parameterArray.pop(),parameterArray.pop(),"_l(("+t+"),function("+parameter2+n+parameter1+"){return "+e+"}),"}function transformIf(r){r.ifCompiled=!0;var t=transformNode(r).replace(/,$/,"");return"_i(("+formatForFunc(r.shown)+"),function(){return "+t+"}),"}function formatForFunc(r){var t,e=r.toString(),n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(t=n.n()).done;){var a=t.value,o="$"===a.charAt(0)?"\\":"",c=new RegExp("this."+o+a+"\\b","g");e=e.replace(c,a)}}catch(r){n.e(r)}finally{n.f()}return e=e.replace(/this\./g,"_vm.")}function transformChildren(r){var t=r.children;if(!t)return null;for(var e="",n=0;n<t.length;n++)e+=transformNode(t[n]);return e="["+e.replace(/,$/,"")+"]"}EVENT_KEY.map(function(r){optionRules[r]=function(t,e,n){return t+="'".concat(r,"' : ").concat(transformEvents(e[r]),",")}}),exports.transformTemplate=transformTemplate;